import{_ as z,c as a,a as t,b as _,j as I,v as J,f as y,F as c,g as f,t as n,n as B,O as L,L as v,C as W,N as j,B as H,S as T,o,J as K,i as Q}from"./app-BLvk--SP.js";const E="orders_selected_columns_v1",R="RMS",Y={name:"Orders",setup(){const O=v([]),e=v(!1),N=v({search:""}),s=[{value:"pending",label:"Pending"},{value:"processing",label:"Processing"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}],m=v({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),V=[{key:"customer_info",label:"Customer Info"},{key:"tracking_id",label:"Tracking ID"},{key:"total_price",label:"Total Price"},{key:"status",label:"Status"},{key:"created_at",label:"Created At"},{key:"actions",label:"Actions"}],D=["customer_info","tracking_id","total_price","status","actions"],p=v([]),C=v([]),w=v([]),x=v(!1),l=v(null);W(()=>{const i=localStorage.getItem(E);i?p.value=JSON.parse(i):p.value=[...D],C.value=[...p.value],r(),k(1)});const r=()=>{w.value=V.filter(i=>p.value.includes(i.key))},M=()=>{p.value=[...C.value],localStorage.setItem(E,JSON.stringify(p.value)),r()},k=async(i=1)=>{e.value=!0;try{const d={page:i,per_page:m.value.per_page};N.value.search&&(d.search=N.value.search);const u=await j.get("/tenant/orders",{params:d});if(u.data.success){const{data:g,current_page:h,last_page:P,per_page:S,total:U,from:A,to:q}=u.data.data;O.value=g,m.value={current_page:h,last_page:P,per_page:S,total:U,from:A,to:q}}else O.value=[],m.value={current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}}catch{O.value=[],m.value={current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}}finally{e.value=!1}},F=i=>{i<1||i>m.value.last_page||k(i)},b=H(()=>{const i=m.value.last_page,d=m.value.current_page,u=5;let g=Math.max(1,d-2),h=Math.min(i,d+2);h-g<u-1&&(g===1?h=Math.min(i,g+u-1):h===i&&(g=Math.max(1,h-u+1)));const P=[];for(let S=g;S<=h;S++)P.push(S);return P});return{orders:O,loading:e,filters:N,pagination:m,goToPage:F,paginationWindow:b,allColumns:V,selectedColumns:p,tempSelectedColumns:C,visibleColumns:w,applyColumnSelection:M,applyFilters:()=>{k(1)},statusOptions:s,updateOrderStatus:async(i,d)=>{const u=i.status;i.status=d;try{await j.get(`/tenant/orders/${i.id}/status-change`,{params:{status:d}}),T.fire({icon:"success",title:"Status updated",toast:!0,position:"top-end",showConfirmButton:!1,timer:1200})}catch{i.status=u,T.fire({icon:"error",title:"Failed to update status",toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3})}},viewOrderDetails:i=>{l.value=i,x.value=!0},showOrderModal:x,selectedOrder:l,updateModalOrderStatus:async i=>{if(!l.value)return;const d=l.value.status;l.value.status=i;try{await j.get(`/tenant/orders/${l.value.id}/status-change`,{params:{status:i}}),T.fire({icon:"success",title:"Status updated",toast:!0,position:"top-end",showConfirmButton:!1,timer:1200}),k(m.value.current_page)}catch{l.value.status=d,T.fire({icon:"error",title:"Failed to update status",toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3})}},appName:R,statusTooltip:"This is your order's current status. If you have questions, please contact support.",orderSubtotal:i=>!i||!i.order_details?"0.00":i.order_details.reduce((d,u)=>d+Number(u.price)*Number(u.quantity),0).toFixed(2),printOrder:()=>{window.print()},copyToClipboard:(i,d)=>{i&&navigator.clipboard.writeText(i).then(()=>{T.fire({icon:"success",title:`Successfully copied ${d.toLowerCase()}:`,text:i,toast:!0,position:"top-end",showConfirmButton:!1,timer:1800})})}}}},G={class:"Orders-page"},X={class:"mb-4"},Z={class:"filter-body row g-3 align-items-end flex-wrap"},$={class:"col-12 col-md-4 mb-2 mb-md-0"},tt={class:"col-12 col-md-3 ms-auto d-flex justify-content-md-end justify-content-start align-items-end"},et={class:"dropdown column-filter-dropdown w-100 w-md-auto"},st={class:"dropdown-menu theme-dropdown shadow-lg p-2","aria-labelledby":"orderColumnDropdown",style:{"min-width":"220px"}},lt={class:"dropdown-item mb-0 d-flex align-items-center gap-2"},at=["value"],ot={class:"card"},nt={class:"card-body"},it={key:0,class:"text-center py-5"},rt={key:1,class:"text-center py-5 text-muted"},dt={key:2,class:"table-responsive"},ct={class:"table table-hover table-sm orders-table"},ut={class:"fw-bold"},mt={class:"small text-muted"},pt={class:"small text-muted"},bt=["onClick"],yt={key:0},_t={key:0,class:"text-success small ms-2"},vt={key:1},gt=["onUpdate:modelValue","onChange"],ft=["value"],kt=["onClick"],ht={key:0,class:"d-flex justify-content-between align-items-center mt-3"},Ct={class:"text-muted"},Ot={key:0},wt={class:"pagination mb-0"},xt=["disabled"],St=["onClick"],Tt=["disabled"],Nt={key:0,class:"modal fade show d-block order-print-modal",tabindex:"-1",style:{background:"rgba(0,0,0,0.25)"}},Dt={class:"modal-dialog modal-lg"},Mt={class:"modal-content print-area"},Ft={class:"p-3 d-flex justify-content-between align-items-center border-bottom pb-2 mb-3 print-header"},Pt={class:"order-date-time"},It={class:"fw-bold"},Vt={class:"app-name fw-bold",style:{"font-size":"1.3rem","letter-spacing":"0.5px"}},Bt={class:"modal-body pt-0"},jt={key:0},Lt={class:"row mb-3 order-info-grid"},Et={class:"col-md-8 mb-2"},Ut={class:"value p-2"},At={class:"value p-2"},qt={class:"badge bg-info"},zt={class:"value p-2"},Jt={class:"value p-2"},Wt={class:"value p-2"},Ht={class:"value p-2"},Kt={class:"value p-2"},Qt={class:"value p-2"},Rt={class:"col-md-4"},Yt={class:"status-area"},Gt={class:"position-relative"},Xt=["title"],Zt=["value"],$t=["title"],te={class:"table table-bordered table-sm mt-2 order-items-table"},ee={class:"text-end"},se={class:"text-end"},le={class:"text-end"},ae={key:0},oe={class:"text-end"},ne={class:"text-end final-total"};function ie(O,e,N,s,m,V){var D,p,C,w,x;return o(),a(c,null,[t("div",G,[e[19]||(e[19]=t("div",{class:"d-flex justify-content-between align-items-center mb-4"},[t("h4",{class:"mb-0"},"Manage Orders")],-1)),t("div",X,[t("div",Z,[t("div",$,[e[12]||(e[12]=t("label",{class:"form-label mb-1"},"Search",-1)),I(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.filters.search=l),onInput:e[1]||(e[1]=(...l)=>s.applyFilters&&s.applyFilters(...l)),type:"text",class:"form-control filter-input",placeholder:"Search by order number or customer name"},null,544),[[J,s.filters.search]])]),t("div",tt,[t("div",et,[e[14]||(e[14]=t("button",{class:"btn btn-theme btn-sm dropdown-toggle w-100",type:"button",id:"orderColumnDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fas fa-columns"}),y(" Columns ")],-1)),t("ul",st,[(o(!0),a(c,null,f(s.allColumns,l=>(o(),a("li",{key:l.key},[t("label",lt,[I(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=r=>s.tempSelectedColumns=r),value:l.key,class:"form-check-input"},null,8,at),[[K,s.tempSelectedColumns]]),t("span",null,n(l.label),1)])]))),128)),e[13]||(e[13]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("button",{class:"btn btn-theme w-100",onClick:e[3]||(e[3]=(...l)=>s.applyColumnSelection&&s.applyColumnSelection(...l))},"Apply")])])])])])]),t("div",ot,[t("div",nt,[s.loading?(o(),a("div",it,e[15]||(e[15]=[t("div",{class:"spinner-border text-danger",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):s.orders.length===0?(o(),a("div",rt,e[16]||(e[16]=[t("i",{class:"fas fa-store fa-3x mb-3",style:{color:"#bdbdbd"}},null,-1),t("div",{class:"h5 mb-2"},"No Orders Found",-1),t("div",null,[y("No orders match your search criteria."),t("br"),y("Try adjusting your filters.")],-1)]))):(o(),a("div",dt,[t("table",ct,[t("thead",null,[t("tr",null,[(o(!0),a(c,null,f(s.visibleColumns,l=>(o(),a("th",{key:l.key},n(l.label),1))),128))])]),t("tbody",null,[(o(!0),a(c,null,f(s.orders,l=>(o(),a("tr",{key:l.id},[(o(!0),a(c,null,f(s.visibleColumns,r=>{var M,k,F;return o(),a("td",{key:r.key},[r.key==="customer_info"?(o(),a(c,{key:0},[t("div",ut,n(((M=l.customer)==null?void 0:M.name)||"-"),1),t("div",mt," Email: "+n(((k=l.customer)==null?void 0:k.email)||"-"),1),t("div",pt," Phone: "+n(((F=l.customer)==null?void 0:F.phone)||"-"),1)],64)):r.key==="tracking_id"?(o(),a(c,{key:1},[y(n(l.tracking_id||"-")+" ",1),l.tracking_id?(o(),a("button",{key:0,class:"btn btn-link btn-copy ms-1 p-0",onClick:Q(b=>s.copyToClipboard(l.tracking_id,"Tracking ID"),["stop"]),title:"Copy Tracking ID"},e[17]||(e[17]=[t("i",{class:"fas fa-copy"},null,-1)]),8,bt)):_("",!0)],64)):r.key==="total_price"?(o(),a(c,{key:2},[l.total_amount?(o(),a("span",yt,[y(n(l.currency_symbol)+" "+n(Number(l.total_amount).toFixed(2))+" ",1),l.applied_discount&&Number(l.applied_discount)>0?(o(),a("span",_t,n(Number(l.applied_discount).toFixed(2))+"% off ",1)):_("",!0)])):(o(),a("span",vt,"-"))],64)):r.key==="status"?I((o(),a("select",{key:3,class:"form-select form-select-sm w-auto d-inline-block","onUpdate:modelValue":b=>l.status=b,onChange:b=>s.updateOrderStatus(l,l.status)},[(o(!0),a(c,null,f(s.statusOptions,b=>(o(),a("option",{key:b.value,value:b.value},n(b.label),9,ft))),128))],40,gt)),[[L,l.status]]):r.key==="created_at"?(o(),a(c,{key:4},[y(n(new Date(l.created_at).toLocaleDateString()),1)],64)):r.key==="actions"?(o(),a("button",{key:5,class:"btn btn-sm btn-theme",onClick:b=>s.viewOrderDetails(l)},e[18]||(e[18]=[t("i",{class:"fas fa-eye"},null,-1),y(" View Details")]),8,kt)):(o(),a(c,{key:6},[y(n(l[r.key]),1)],64))])}),128))]))),128))])]),s.pagination.total>0?(o(),a("div",ht,[t("div",Ct," Showing "+n(s.pagination.from)+" to "+n(s.pagination.to)+" of "+n(s.pagination.total)+" entries ",1),s.pagination.last_page>1?(o(),a("nav",Ot,[t("ul",wt,[t("li",{class:B(["page-item",{disabled:s.pagination.current_page===1}])},[t("button",{class:"page-link",onClick:e[4]||(e[4]=l=>s.goToPage(s.pagination.current_page-1)),disabled:s.pagination.current_page===1},"«",8,xt)],2),(o(!0),a(c,null,f(s.paginationWindow,l=>(o(),a("li",{key:l,class:B(["page-item",{active:l===s.pagination.current_page}])},[t("button",{class:"page-link",onClick:r=>s.goToPage(l)},n(l),9,St)],2))),128)),t("li",{class:B(["page-item",{disabled:s.pagination.current_page===s.pagination.last_page}])},[t("button",{class:"page-link",onClick:e[5]||(e[5]=l=>s.goToPage(s.pagination.current_page+1)),disabled:s.pagination.current_page===s.pagination.last_page},"»",8,Tt)],2)])])):_("",!0)])):_("",!0)]))])])]),s.showOrderModal?(o(),a("div",Nt,[t("div",Dt,[t("div",Mt,[t("div",Ft,[t("div",Pt,[e[20]||(e[20]=t("small",{class:"text-muted"},"Order Date:",-1)),e[21]||(e[21]=t("br",null,null,-1)),t("span",It,n(s.selectedOrder?new Date(s.selectedOrder.created_at).toLocaleString():""),1)]),t("div",Vt,n(s.appName),1),t("button",{type:"button",class:"btn-close d-print-none ms-2",onClick:e[6]||(e[6]=l=>s.showOrderModal=!1)})]),e[40]||(e[40]=t("div",{class:"d-flex justify-content-between align-items-center mb-2 px-3"},[t("h4",{class:"modal-title flex-grow-1 mb-0"},"Order Details")],-1)),t("div",Bt,[s.selectedOrder?(o(),a("div",jt,[t("div",Lt,[t("div",Et,[t("div",null,[e[22]||(e[22]=t("span",{class:"label"},"Order Number:",-1)),t("span",Ut,n(s.selectedOrder.order_number),1)]),t("div",null,[e[24]||(e[24]=t("span",{class:"label"},"Tracking ID:",-1)),t("span",At,[t("span",qt,n(s.selectedOrder.tracking_id),1),t("button",{class:"btn btn-link btn-copy ms-1 p-0",onClick:e[7]||(e[7]=l=>s.copyToClipboard(s.selectedOrder.tracking_id,"Tracking ID")),title:"Copy Tracking ID"},e[23]||(e[23]=[t("i",{class:"fas fa-copy"},null,-1)]))])]),t("div",null,[e[25]||(e[25]=t("span",{class:"label"},"Customer Name:",-1)),t("span",zt,n((D=s.selectedOrder.customer)==null?void 0:D.name),1)]),t("div",null,[e[27]||(e[27]=t("span",{class:"label"},"Customer Email:",-1)),t("span",Jt,[y(n((p=s.selectedOrder.customer)==null?void 0:p.email)+" ",1),(C=s.selectedOrder.customer)!=null&&C.email?(o(),a("button",{key:0,class:"btn btn-link btn-copy ms-1 p-0",onClick:e[8]||(e[8]=l=>s.copyToClipboard(s.selectedOrder.customer.email,"Email")),title:"Copy Email"},e[26]||(e[26]=[t("i",{class:"fas fa-copy"},null,-1)]))):_("",!0)])]),t("div",null,[e[29]||(e[29]=t("span",{class:"label"},"Customer Phone:",-1)),t("span",Wt,[y(n((w=s.selectedOrder.customer)==null?void 0:w.phone)+" ",1),(x=s.selectedOrder.customer)!=null&&x.phone?(o(),a("button",{key:0,class:"btn btn-link btn-copy ms-1 p-0",onClick:e[9]||(e[9]=l=>s.copyToClipboard(s.selectedOrder.customer.phone,"Phone")),title:"Copy Phone"},e[28]||(e[28]=[t("i",{class:"fas fa-copy"},null,-1)]))):_("",!0)])]),t("div",null,[e[30]||(e[30]=t("span",{class:"label"},"Delivery Address:",-1)),t("span",Ht,n(s.selectedOrder.delivery_address),1)]),t("div",null,[e[31]||(e[31]=t("span",{class:"label"},"Payment Status:",-1)),t("span",Kt,n(s.selectedOrder.payment_status),1)]),t("div",null,[e[32]||(e[32]=t("span",{class:"label"},"Created At:",-1)),t("span",Qt,n(new Date(s.selectedOrder.created_at).toLocaleString()),1)])]),t("div",Rt,[e[34]||(e[34]=t("div",{class:"mb-2"},[t("strong",null,"Change Status:")],-1)),t("div",Yt,[e[33]||(e[33]=t("span",{class:"fw-bold"},"Status:",-1)),t("span",Gt,[I(t("select",{class:"form-select form-select-sm w-auto d-inline-block status-select ms-2","onUpdate:modelValue":e[10]||(e[10]=l=>s.selectedOrder.status=l),onChange:e[11]||(e[11]=l=>s.updateModalOrderStatus(s.selectedOrder.status)),title:s.statusTooltip},[(o(!0),a(c,null,f(s.statusOptions,l=>(o(),a("option",{key:l.value,value:l.value},n(l.label),9,Zt))),128))],40,Xt),[[L,s.selectedOrder.status]]),t("i",{class:"fas fa-info-circle text-muted ms-1",title:s.statusTooltip,style:{cursor:"help"}},null,8,$t)])])])])])):_("",!0),e[39]||(e[39]=t("div",{class:"mb-2"},[t("strong",null,"Order Items:")],-1)),t("table",te,[e[38]||(e[38]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Product"),t("th",null,"Quantity"),t("th",{class:"text-end"},"Unit Price"),t("th",{class:"text-end"},"Total")])],-1)),t("tbody",null,[(o(!0),a(c,null,f(s.selectedOrder.order_details||[],l=>{var r;return o(),a("tr",{key:l.id},[t("td",null,n(((r=l.product)==null?void 0:r.name)||"-"),1),t("td",null,n(l.quantity),1),t("td",ee,n(l.price?s.selectedOrder.currency_symbol+Number(l.price).toFixed(2):"-"),1),t("td",se,n(l.price&&l.quantity?s.selectedOrder.currency_symbol+(Number(l.price)*Number(l.quantity)).toFixed(2):"-"),1)])}),128))]),t("tfoot",null,[t("tr",null,[e[35]||(e[35]=t("th",{colspan:"3",class:"text-end"},"Subtotal:",-1)),t("th",le,n(s.selectedOrder.currency_symbol)+" "+n(s.orderSubtotal(s.selectedOrder)),1)]),s.selectedOrder.applied_discount&&Number(s.selectedOrder.applied_discount)>0?(o(),a("tr",ae,[e[36]||(e[36]=t("th",{colspan:"3",class:"text-end"},"Discount:",-1)),t("th",oe,"-"+n(s.selectedOrder.currency_symbol)+" "+n(Number(s.selectedOrder.applied_discount).toFixed(2)),1)])):_("",!0),t("tr",null,[e[37]||(e[37]=t("th",{colspan:"3",class:"text-end"},"Final Total:",-1)),t("th",ne,n(s.selectedOrder.currency_symbol)+" "+n((Number(s.orderSubtotal(s.selectedOrder))-Number(s.selectedOrder.applied_discount||0)).toFixed(2)),1)])])])])])])])):_("",!0)],64)}const ve=z(Y,[["render",ie],["__scopeId","data-v-cf438393"]]);export{ve as default};
//# sourceMappingURL=Orders-DfO9I-j6.js.map
