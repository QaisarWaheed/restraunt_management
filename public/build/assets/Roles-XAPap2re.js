import{_ as j,c as d,o as r,a as s,t as l,f as y,F as C,g as M,b as f,i as z,j as E,v as B,n as x,J as D,L as v,C as L,N as w,S as h,P as A}from"./app-BLvk--SP.js";const Y={name:"Roles",setup(){const n=v([]),t=v([]),b=v(!0),o=v(null),_=v(!1),g=v(null),e=v(null),c=v({}),k=v({name:"",description:"",permissions:[]}),R=async()=>{var i,m;try{b.value=!0,o.value=null;const a=await w.get("/dashboard/roles");console.log("Roles response:",a.data),a.data&&a.data.data?n.value=a.data.data:n.value=[]}catch(a){console.error("Error fetching roles:",a),o.value=((m=(i=a.response)==null?void 0:i.data)==null?void 0:m.message)||"Failed to load roles",n.value=[]}finally{b.value=!1}},S=async()=>{var i,m;try{const a=await w.get("/dashboard/permissions");console.log("Permissions response:",a.data),a.data&&a.data.data?t.value=a.data.data:t.value=[]}catch(a){console.error("Error fetching permissions:",a),t.value=[],h.fire({icon:"error",title:"Error",text:((m=(i=a.response)==null?void 0:i.data)==null?void 0:m.message)||"Failed to load permissions"})}},N=()=>{_.value=!1,g.value=null,k.value={name:"",description:"",permissions:[]},c.value={};const i=document.getElementById("roleModal");i&&(e.value=new A(i),e.value.show())},P=i=>{_.value=!0,g.value=i.id,k.value={name:i.name,description:i.description||"",permissions:(i.permissions||[]).map(a=>a.id)},c.value={};const m=document.getElementById("roleModal");m&&(e.value=new A(m),e.value.show())},F=()=>{e.value&&e.value.hide(),c.value={}},V=async()=>{var i,m,a,p;try{b.value=!0,c.value={},o.value=null;const u=_.value?`/dashboard/roles/${g.value}`:"/dashboard/roles",T=_.value?"put":"post",U=await w[T](u,k.value);console.log("Save role response:",U.data),await h.fire({icon:"success",title:"Success",text:_.value?"Role updated successfully":"Role created successfully",timer:1500,showConfirmButton:!1}),F(),await R()}catch(u){console.error("Error saving role:",u),(m=(i=u.response)==null?void 0:i.data)!=null&&m.errors?c.value=u.response.data.errors:h.fire({icon:"error",title:"Error",text:((p=(a=u.response)==null?void 0:a.data)==null?void 0:p.message)||"Failed to save role"})}finally{b.value=!1}},I=async i=>{var a,p;if(i.name==="super_admin")return;if((await h.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{b.value=!0,o.value=null,await w.delete(`/dashboard/roles/${i.id}`),await h.fire({icon:"success",title:"Success",text:"Role deleted successfully",timer:1500,showConfirmButton:!1}),await R()}catch(u){console.error("Error deleting role:",u),h.fire({icon:"error",title:"Error",text:((p=(a=u.response)==null?void 0:a.data)==null?void 0:p.message)||"Failed to delete role"})}finally{b.value=!1}};return L(async()=>{try{await Promise.all([R(),S()])}catch(i){console.error("Error during initialization:",i)}}),{roles:n,permissions:t,loading:b,error:o,isEditing:_,errors:c,roleForm:k,openAddRoleModal:N,editRole:P,closeModal:F,saveRole:V,deleteRole:I}}},J={class:"roles-management"},q={class:"container-fluid"},G={class:"row mb-4"},H={class:"col"},K={class:"text-muted"},O={class:"col-auto"},Q={key:0,class:"text-center my-5"},W={class:"spinner-border text-primary",role:"status"},X={class:"visually-hidden"},Z={key:1,class:"alert alert-danger",role:"alert"},$={key:2,class:"text-center my-5"},ss={class:"empty-state"},es={key:3,class:"card"},os={class:"card-body"},ts={class:"table-responsive"},ls={class:"table table-hover table-sm"},ns={class:"d-none d-md-table-cell"},as={class:"d-none d-md-table-cell"},is={class:"d-none d-md-table-cell"},ds={class:"d-none d-md-table-cell"},rs={class:"fw-bold"},cs={class:"d-md-none small text-muted"},ms={key:0},us={key:1},vs={key:2},bs={key:0},_s={class:"d-none d-md-table-cell"},fs={class:"d-none d-md-table-cell"},hs={class:"d-none d-md-table-cell"},ps={class:"permissions-badges"},ys={key:0,class:"badge bg-secondary"},gs={class:"d-none d-md-table-cell"},ks={class:"btn-group"},ws=["onClick"],Rs=["onClick","disabled"],Cs={class:"modal fade",id:"roleModal",tabindex:"-1","data-bs-backdrop":"static"},Ms={class:"modal-dialog modal-lg"},Es={class:"modal-content"},Fs={class:"modal-header"},Bs={class:"modal-title"},xs={class:"modal-body"},As={class:"mb-3"},Ss={class:"form-label"},Ns={key:0,class:"invalid-feedback"},Ps={class:"mb-3"},Vs={class:"form-label"},Is={key:0,class:"invalid-feedback"},Ts={class:"mb-3"},Us={class:"form-label"},js={key:0,class:"alert alert-warning"},zs={key:1,class:"permissions-grid"},Ds=["id","value"],Ls=["for"],Ys={class:"modal-footer"},Js=["disabled"],qs={key:0,class:"spinner-border spinner-border-sm me-1"};function Gs(n,t,b,o,_,g){return r(),d("div",J,[s("div",q,[s("div",G,[s("div",H,[s("h2",null,l(n.$t("roles_module.title")),1),s("p",K,l(n.$t("roles_module.description")),1)]),s("div",O,[s("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>o.openAddRoleModal&&o.openAddRoleModal(...e))},[t[9]||(t[9]=s("i",{class:"fas fa-plus me-2"},null,-1)),y(l(n.$t("roles_module.addNew")),1)])])]),o.loading?(r(),d("div",Q,[s("div",W,[s("span",X,l(n.$t("common.loading")),1)])])):o.error?(r(),d("div",Z,l(o.error),1)):!o.roles||o.roles.length===0?(r(),d("div",$,[s("div",ss,[t[11]||(t[11]=s("i",{class:"fas fa-store fa-4x text-muted mb-4"},null,-1)),t[12]||(t[12]=s("h3",null,"No Roles Found",-1)),t[13]||(t[13]=s("p",{class:"text-muted"},"There are no roles registered yet.",-1)),s("button",{class:"btn btn-primary mt-3",onClick:t[1]||(t[1]=(...e)=>o.openAddRoleModal&&o.openAddRoleModal(...e))},t[10]||(t[10]=[s("i",{class:"fas fa-plus me-2"},null,-1),y("Add First Role ")]))])])):(r(),d("div",es,[s("div",os,[s("div",ts,[s("table",ls,[s("thead",null,[s("tr",null,[s("th",null,l(n.$t("roles_module.columns.name")),1),s("th",ns,l(n.$t("common.description")),1),s("th",as,l(n.$t("common.usersCount")),1),s("th",is,l(n.$t("roles_module.columns.permissions")),1),s("th",ds,l(n.$t("common.actions")),1)])]),s("tbody",null,[(r(!0),d(C,null,M(o.roles,e=>(r(),d("tr",{key:e.id,class:"d-block d-md-table-row w-100 mb-2 mb-md-0"},[s("td",null,[s("div",rs,l(e.name),1),s("div",cs,[e.description?(r(),d("span",ms,l(e.description),1)):(r(),d("span",us,"-")),t[14]||(t[14]=s("br",null,null,-1)),y(" Users: "+l(e.users_count||0),1),t[15]||(t[15]=s("br",null,null,-1)),e.permissions&&e.permissions.length?(r(),d("span",vs,[y("Permissions: "+l(e.permissions.slice(0,3).map(c=>c.name).join(", ")),1),e.permissions.length>3?(r(),d("span",bs," +"+l(e.permissions.length-3)+" more",1)):f("",!0)])):f("",!0)])]),s("td",_s,l(e.description||"-"),1),s("td",fs,l(e.users_count||0),1),s("td",hs,[s("div",ps,[(r(!0),d(C,null,M((e.permissions||[]).slice(0,3),c=>(r(),d("span",{key:c.id,class:"badge bg-info me-1"},l(c.name),1))),128)),e.permissions&&e.permissions.length>3?(r(),d("span",ys,"+"+l(e.permissions.length-3)+" more",1)):f("",!0)])]),s("td",gs,[s("div",ks,[s("button",{class:"btn btn-sm btn-outline-primary",onClick:c=>o.editRole(e)},t[16]||(t[16]=[s("i",{class:"fas fa-edit"},null,-1)]),8,ws),s("button",{class:"btn btn-sm btn-outline-danger",onClick:c=>o.deleteRole(e),disabled:e.name==="super_admin"},t[17]||(t[17]=[s("i",{class:"fas fa-trash"},null,-1)]),8,Rs)])])]))),128))])])])])]))]),s("div",Cs,[s("div",Ms,[s("div",Es,[s("div",Fs,[s("h5",Bs,l(o.isEditing?n.$t("roles_module.editRole"):n.$t("roles_module.addRole")),1),s("button",{type:"button",class:"btn-close",onClick:t[2]||(t[2]=(...e)=>o.closeModal&&o.closeModal(...e))})]),s("div",xs,[s("form",{onSubmit:t[6]||(t[6]=z((...e)=>o.saveRole&&o.saveRole(...e),["prevent"]))},[s("div",As,[s("label",Ss,l(n.$t("roles_module.form.name")),1),E(s("input",{type:"text",class:x(["form-control",{"is-invalid":o.errors.name}]),"onUpdate:modelValue":t[3]||(t[3]=e=>o.roleForm.name=e)},null,2),[[B,o.roleForm.name]]),o.errors.name?(r(),d("div",Ns,l(o.errors.name[0]),1)):f("",!0)]),s("div",Ps,[s("label",Vs,l(n.$t("common.description")),1),E(s("textarea",{class:x(["form-control",{"is-invalid":o.errors.description}]),"onUpdate:modelValue":t[4]||(t[4]=e=>o.roleForm.description=e),rows:"3"},null,2),[[B,o.roleForm.description]]),o.errors.description?(r(),d("div",Is,l(o.errors.description[0]),1)):f("",!0)]),s("div",Ts,[s("label",Us,l(n.$t("roles_module.form.permissions")),1),!o.permissions||o.permissions.length===0?(r(),d("div",js,l(n.$t("roles_module.noPermissionsFound")),1)):(r(),d("div",zs,[(r(!0),d(C,null,M(o.permissions,e=>(r(),d("div",{key:e.id,class:"form-check"},[E(s("input",{type:"checkbox",class:"form-check-input",id:"permission-"+e.id,value:e.id,"onUpdate:modelValue":t[5]||(t[5]=c=>o.roleForm.permissions=c)},null,8,Ds),[[D,o.roleForm.permissions]]),s("label",{class:"form-check-label",for:"permission-"+e.id},l(e.name),9,Ls)]))),128))]))])],32)]),s("div",Ys,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=(...e)=>o.closeModal&&o.closeModal(...e))},l(n.$t("common.cancel")),1),s("button",{type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...e)=>o.saveRole&&o.saveRole(...e)),disabled:o.loading},[o.loading?(r(),d("span",qs)):f("",!0),y(" "+l(o.isEditing?n.$t("common.update"):n.$t("common.create")),1)],8,Js)])])])])])}const Ks=j(Y,[["render",Gs],["__scopeId","data-v-732ea7af"]]);export{Ks as default};
//# sourceMappingURL=Roles-XAPap2re.js.map
