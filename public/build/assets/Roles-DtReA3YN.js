import{_ as q,c as a,a as e,f,t as c,F as C,g as A,i as Y,j as w,v as F,J as S,b as k,L as m,C as z,N as x,S as g,P as N,o as i}from"./app-BLvk--SP.js";const J={name:"Roles",setup(){const y=m([]),s=m([]),p=m(!0),t=m(null),v=m(!1),h=m(null),o=m(null),r=m({}),M=m(!1),b=m({name:"",description:"",permissions:[]}),R=async()=>{var l,d;try{p.value=!0,t.value=null;const n=await x.get("/tenant/roles");console.log("Roles response:",n.data),n.data&&n.data.data?y.value=n.data.data:y.value=[]}catch(n){console.error("Error fetching roles:",n),t.value=((d=(l=n.response)==null?void 0:l.data)==null?void 0:d.message)||"Failed to load roles",y.value=[]}finally{p.value=!1}},P=async()=>{var l,d;try{const n=await x.get("/tenant/permissions");console.log("Permissions response:",n.data),n.data&&n.data.data?s.value=n.data.data:s.value=[]}catch(n){console.error("Error fetching permissions:",n),s.value=[],g.fire({icon:"error",title:"Error",text:((d=(l=n.response)==null?void 0:l.data)==null?void 0:d.message)||"Failed to load permissions"})}},B=()=>{v.value=!1,h.value=null,b.value={name:"",description:"",permissions:[]},r.value={};const l=document.getElementById("roleModal");l&&(o.value=new N(l),o.value.show())},U=l=>{v.value=!0,h.value=l.id,b.value={name:l.name,description:l.description||"",permissions:(l.permissions||[]).map(n=>n.id)},r.value={};const d=document.getElementById("roleModal");d&&(o.value=new N(d),o.value.show())},E=()=>{o.value&&o.value.hide(),r.value={}},V=async()=>{var l,d,n,_;try{p.value=!0,r.value={},t.value=null;const u=v.value?`/tenant/roles/${h.value}`:"/tenant/roles",L=v.value?"put":"post",j=await x[L](u,b.value);console.log("Save role response:",j.data),await g.fire({icon:"success",title:"Success",text:v.value?"Role updated successfully":"Role created successfully",timer:1500,showConfirmButton:!1}),E(),await R()}catch(u){console.error("Error saving role:",u),(d=(l=u.response)==null?void 0:l.data)!=null&&d.errors?r.value=u.response.data.errors:g.fire({icon:"error",title:"Error",text:((_=(n=u.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to save role"})}finally{p.value=!1}},D=async l=>{var n,_;if(l.name==="super_admin")return;if((await g.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{p.value=!0,t.value=null,await x.delete(`/tenant/roles/${l.id}`),await g.fire({icon:"success",title:"Success",text:"Role deleted successfully",timer:1500,showConfirmButton:!1}),await R()}catch(u){console.error("Error deleting role:",u),g.fire({icon:"error",title:"Error",text:((_=(n=u.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to delete role"})}finally{p.value=!1}};function I(){M.value?b.value.permissions=s.value.map(l=>l.id):b.value.permissions=[]}function T(l){return l?l.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()):""}return z(async()=>{try{await Promise.all([R(),P()]),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(l=>{new window.bootstrap.Tooltip(l)})}catch(l){console.error("Error during initialization:",l)}}),{roles:y,permissions:s,loading:p,error:t,isEditing:v,errors:r,roleForm:b,openAddRoleModal:B,editRole:U,closeModal:E,saveRole:V,deleteRole:D,selectAll:M,toggleSelectAll:I,formatPermissionName:T}}},W={class:"roles-management"},G={class:"container-fluid"},H={class:"row mb-4"},K={class:"col-auto"},O={key:0,class:"text-center my-5"},Q={key:1,class:"alert alert-danger",role:"alert"},X={key:2,class:"text-center my-5"},Z={class:"empty-state"},$={key:3,class:"card"},ee={class:"card-body"},se={class:"table-responsive"},oe={class:"table table-hover table-sm"},te={class:"fw-bold"},le={class:"d-md-none small text-muted"},ne={key:0},ae={key:1},ie={key:2},re={key:0},de={class:"d-none d-md-table-cell"},ce={class:"d-none d-md-table-cell"},me={class:"d-none d-md-table-cell"},ue={class:"permissions-badges"},pe={key:0,class:"badge bg-secondary"},ve={class:"d-none d-md-table-cell"},be={class:"btn-group"},fe=["onClick"],ge=["onClick","disabled"],ye={class:"modal fade",id:"roleModal",tabindex:"-1","data-bs-backdrop":"static"},_e={class:"modal-dialog modal-lg"},he={class:"modal-content role-modal-content"},we={class:"modal-header role-modal-header"},ke={class:"modal-title role-modal-title"},xe={class:"modal-body role-modal-body"},Re={class:"row g-3 mb-3"},Ce={class:"col-md-6"},Ae={class:"input-group"},Me={class:"col-md-6"},Ee={class:"input-group"},Fe={class:"mb-3"},Se={class:"mb-2"},Ne={key:0,class:"alert alert-warning"},Pe={key:1,class:"permissions-grid role-permissions-grid"},Be=["id","value","title"],Ue=["for"],Ve={class:"modal-footer role-modal-footer"},De=["disabled"],Ie={key:0,class:"spinner-border spinner-border-sm me-1"};function Te(y,s,p,t,v,h){return i(),a("div",W,[e("div",G,[e("div",H,[s[11]||(s[11]=e("div",{class:"col"},[e("h2",null,"Roles & Permissions"),e("p",{class:"text-muted"},"Manage system roles and their permissions")],-1)),e("div",K,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=(...o)=>t.openAddRoleModal&&t.openAddRoleModal(...o))},s[10]||(s[10]=[e("i",{class:"fas fa-plus me-2"},null,-1),f("Add New Role ")]))])]),t.loading?(i(),a("div",O,s[12]||(s[12]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):t.error?(i(),a("div",Q,c(t.error),1)):!t.roles||t.roles.length===0?(i(),a("div",X,[e("div",Z,[s[14]||(s[14]=e("i",{class:"fas fa-store fa-4x text-muted mb-4"},null,-1)),s[15]||(s[15]=e("h3",null,"No Roles Found",-1)),s[16]||(s[16]=e("p",{class:"text-muted"},"There are no roles registered yet.",-1)),e("button",{class:"btn btn-primary mt-3",onClick:s[1]||(s[1]=(...o)=>t.openAddRoleModal&&t.openAddRoleModal(...o))},s[13]||(s[13]=[e("i",{class:"fas fa-plus me-2"},null,-1),f("Add First Role ")]))])])):(i(),a("div",$,[e("div",ee,[e("div",se,[e("table",oe,[s[21]||(s[21]=e("thead",null,[e("tr",null,[e("th",null,"Role Name"),e("th",{class:"d-none d-md-table-cell"},"Description"),e("th",{class:"d-none d-md-table-cell"},"Users Count"),e("th",{class:"d-none d-md-table-cell"},"Permissions"),e("th",{class:"d-none d-md-table-cell"},"Actions")])],-1)),e("tbody",null,[(i(!0),a(C,null,A(t.roles,o=>(i(),a("tr",{key:o.id,class:"d-block d-md-table-row w-100 mb-2 mb-md-0"},[e("td",null,[e("div",te,c(o.name),1),e("div",le,[o.description?(i(),a("span",ne,c(o.description),1)):(i(),a("span",ae,"-")),s[17]||(s[17]=e("br",null,null,-1)),f(" Users: "+c(o.users_count||0),1),s[18]||(s[18]=e("br",null,null,-1)),o.permissions&&o.permissions.length?(i(),a("span",ie,[f("Permissions: "+c(o.permissions.slice(0,3).map(r=>r.name).join(", ")),1),o.permissions.length>3?(i(),a("span",re," +"+c(o.permissions.length-3)+" more",1)):k("",!0)])):k("",!0)])]),e("td",de,c(o.description||"-"),1),e("td",ce,c(o.users_count||0),1),e("td",me,[e("div",ue,[(i(!0),a(C,null,A((o.permissions||[]).slice(0,3),r=>(i(),a("span",{key:r.id,class:"badge bg-info me-1"},c(r.name),1))),128)),o.permissions&&o.permissions.length>3?(i(),a("span",pe,"+"+c(o.permissions.length-3)+" more",1)):k("",!0)])]),e("td",ve,[e("div",be,[e("button",{class:"btn btn-sm btn-outline-primary",onClick:r=>t.editRole(o)},s[19]||(s[19]=[e("i",{class:"fas fa-edit"},null,-1)]),8,fe),e("button",{class:"btn btn-sm btn-outline-danger",onClick:r=>t.deleteRole(o),disabled:o.name==="super_admin"},s[20]||(s[20]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ge)])])]))),128))])])])])]))]),e("div",ye,[e("div",_e,[e("div",he,[e("div",we,[e("h5",ke,c(t.isEditing?"Edit Role":"Add New Role"),1),e("button",{type:"button",class:"btn-close",onClick:s[2]||(s[2]=(...o)=>t.closeModal&&t.closeModal(...o))})]),e("div",xe,[e("form",{onSubmit:s[9]||(s[9]=Y((...o)=>t.saveRole&&t.saveRole(...o),["prevent"]))},[e("div",Re,[e("div",Ce,[e("div",Ae,[s[22]||(s[22]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-user-tag"})],-1)),w(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=o=>t.roleForm.name=o),placeholder:"Role Name*",required:"","data-bs-toggle":"tooltip",title:"Enter a descriptive name for this role (e.g. Manager, Waiter)"},null,512),[[F,t.roleForm.name]])])]),e("div",Me,[e("div",Ee,[s[23]||(s[23]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-align-left"})],-1)),w(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=o=>t.roleForm.description=o),placeholder:"Description (optional)","data-bs-toggle":"tooltip",title:"Describe the responsibilities or scope of this role (optional)"},null,512),[[F,t.roleForm.description]])])])]),e("div",Fe,[s[25]||(s[25]=e("label",{class:"form-label mb-2"},[f(" Permissions "),e("i",{class:"fas fa-info-circle ms-1","data-bs-toggle":"tooltip",title:"Select the permissions this role should have"})],-1)),e("div",Se,[w(e("input",{type:"checkbox",id:"selectAllPermissions","onUpdate:modelValue":s[5]||(s[5]=o=>t.selectAll=o),onChange:s[6]||(s[6]=(...o)=>t.toggleSelectAll&&t.toggleSelectAll(...o))},null,544),[[S,t.selectAll]]),s[24]||(s[24]=e("label",{for:"selectAllPermissions",class:"ms-1","data-bs-toggle":"tooltip",title:"Select or deselect all permissions"},"Select All",-1))]),!t.permissions||t.permissions.length===0?(i(),a("div",Ne," No permissions found ")):(i(),a("div",Pe,[(i(!0),a(C,null,A(t.permissions,o=>(i(),a("div",{key:o.id,class:"form-check"},[w(e("input",{type:"checkbox",class:"form-check-input",id:"permission-"+o.id,value:o.id,"onUpdate:modelValue":s[7]||(s[7]=r=>t.roleForm.permissions=r),title:"Allow "+t.formatPermissionName(o.name),"data-bs-toggle":"tooltip"},null,8,Be),[[S,t.roleForm.permissions]]),e("label",{class:"form-check-label",for:"permission-"+o.id},c(t.formatPermissionName(o.name)),9,Ue)]))),128))]))]),e("div",Ve,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[8]||(s[8]=(...o)=>t.closeModal&&t.closeModal(...o))}," Cancel "),e("button",{type:"submit",class:"btn btn-submit",disabled:t.loading},[t.loading?(i(),a("span",Ie)):k("",!0),f(" "+c(t.isEditing?"Update":"Create"),1)],8,De)])],32)])])])])])}const je=q(J,[["render",Te],["__scopeId","data-v-9533048c"]]);export{je as default};
//# sourceMappingURL=Roles-DtReA3YN.js.map
