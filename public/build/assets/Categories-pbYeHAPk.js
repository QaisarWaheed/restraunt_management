import{_ as K,c as i,a as t,f as m,j as M,v as U,O as q,F as P,g as L,b as h,e as Q,w as X,r as Z,t as n,n as A,i as $,J as tt,L as u,B as et,C as ot,P as j,T as at,N as C,S as g,o as r}from"./app-BLvk--SP.js";import{d as st}from"./vuedraggable.umd-BKuQl9O6.js";const lt={name:"Categories",components:{draggable:st},setup(){const D=u([]),e=u([]),x=u(!1),o=u(null),E=u(null),V=u(null),S=u(!1),B=u([]),v=u({current_page:1,last_page:1,per_page:5,total:0,from:0,to:0}),F=async()=>{try{const s=await C.get("/tenant/categories",{params:{only_deleted:!0}});B.value=s.data.data.data,k.value.show()}catch(s){console.error("Error fetching deleted categories:",s),g.fire({icon:"error",title:"Error",text:"Failed to fetch deleted categories"})}},k=u(null),y=u({name:"",description:"",parent_id:"",is_active:!0,sort_order:0,image:""}),p=u({search:"",parent_id:"",is_active:""}),b=async(s=1)=>{S.value=!0;try{const d={page:s,per_page:v.value.per_page};p.value.search&&(d.search=p.value.search),p.value.parent_id&&(d.parent_id=p.value.parent_id),p.value.is_active!==""&&(d.is_active=p.value.is_active);const l=(await C.get("/tenant/categories",{params:d})).data.data;D.value=l.data,v.value={current_page:l.current_page,last_page:l.last_page,per_page:l.per_page,total:l.total,from:l.from,to:l.to}}catch{D.value=[],v.value={current_page:1,last_page:1,per_page:5,total:0,from:0,to:0}}finally{S.value=!1}},_=async()=>{try{const s=await C.get("/tenant/categories");e.value=s.data.data.data}catch(s){console.error("Error fetching parent categories:",s)}},T=()=>{x.value=!1,y.value={name:"",description:"",parent_id:"",is_active:!0,sort_order:0,image:""},E.value.show()},N=s=>{x.value=!0,y.value={id:s.id,name:s.name,description:s.description,parent_id:s.parent_id,is_active:s.is_active,sort_order:s.sort_order,image:s.image},E.value.show()},a=s=>{o.value=s,V.value.show()},w=async()=>{var s,d;try{x.value?await C.put(`/tenant/categories/${y.value.id}`,y.value):await C.post("/tenant/categories",y.value),await b(),await _(),E.value.hide(),g.fire({icon:"success",title:x.value?"Category Updated":"Category Created",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}catch(c){console.error("Error saving category:",c),g.fire({icon:"error",title:"Error",text:((d=(s=c.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to save category"})}},z=s=>{g.fire({title:"Are you sure?",text:"This will delete the category. This action can be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"}).then(async d=>{var c,l;if(d.isConfirmed)try{await C.delete(`/tenant/categories/${s.id}`),await b(),await _(),g.fire({icon:"success",title:"Category Deleted",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}catch(f){console.error("Error deleting category:",f),g.fire({icon:"error",title:"Error",text:((l=(c=f.response)==null?void 0:c.data)==null?void 0:l.message)||"Failed to delete category"})}})},H=s=>{g.fire({title:"Are you absolutely sure?",text:"This will permanently delete the category. This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, permanently delete!"}).then(async d=>{var c,l;if(d.isConfirmed)try{await C.delete(`/tenant/categories/${s.id}/force`),await b(),await _(),g.fire({icon:"success",title:"Category Permanently Deleted",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}catch(f){console.error("Error permanently deleting category:",f),g.fire({icon:"error",title:"Error",text:((l=(c=f.response)==null?void 0:c.data)==null?void 0:l.message)||"Failed to permanently delete category"})}})},R=async s=>{var d,c;try{await C.post(`/tenant/categories/${s.id}/restore`),await b(),await _(),g.fire({icon:"success",title:"Category Restored",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}catch(l){console.error("Error restoring category:",l),g.fire({icon:"error",title:"Error",text:((c=(d=l.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to restore category"})}},W=()=>{b(1)},Y=s=>{s<1||s>v.value.last_page||b(s)},J=et(()=>{const s=v.value.last_page,d=v.value.current_page,c=5;let l=Math.max(1,d-2),f=Math.min(s,d+2);f-l<c-1&&(l===1?f=Math.min(s,l+c-1):f===s&&(l=Math.max(1,f-c+1)));const O=[];for(let I=l;I<=f;I++)O.push(I);return O}),G=async()=>{try{const s=D.value.map((d,c)=>({id:d.id,sort_order:c}));await C.post("/tenant/categories/reorder",{order:s}),await b(),g.fire({icon:"success",title:"Order updated",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}catch{g.fire({icon:"error",title:"Error",text:"Failed to update order"})}};return ot(()=>{E.value=new j(document.getElementById("CategoryModal")),V.value=new j(document.getElementById("viewCategoryModal")),k.value=new j(document.getElementById("deletedCategoriesModal")),b(),_(),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(s=>{new at(s)})}),{categories:D,parentCategories:e,isEditing:x,selectedCategory:o,form:y,showCreateModal:T,editCategory:N,viewCategory:a,saveCategory:w,confirmDelete:z,confirmHardDelete:H,restoreCategory:R,filters:p,applyFilters:W,loading:S,deletedCategories:B,showDeletedModal:F,deletedCategoriesModal:k,onSortEnd:G,pagination:v,goToPage:Y,paginationWindow:J}}},nt={class:"Categories-page"},it={class:"d-flex justify-content-between align-items-center mb-4"},rt={class:"mb-4"},dt={class:"filter-body"},ct={class:"row g-3 align-items-end flex-nowrap flex-md-nowrap flex-column flex-md-row"},mt={class:"col-md-4 col-12 mb-2 mb-md-0"},gt={class:"col-12 d-md-none mb-2"},ut=["value"],bt={class:"col-md-4 col-12 mb-2 mb-md-0"},ft={class:"card"},vt={class:"card-body"},pt={key:0,class:"text-center py-5"},yt={key:1,class:"text-center py-5 text-muted"},Ct={key:2,class:"table-responsive"},_t={class:"table table-hover table-sm Categories-table"},wt={class:"fw-bold"},ht={class:"small text-muted"},xt={class:"d-none d-md-table-cell"},kt={class:"d-none d-md-table-cell"},Mt={class:"d-none d-md-table-cell"},Dt={class:"d-none d-md-table-cell"},Et={class:"btn-group"},St=["onClick"],Bt=["onClick"],At=["onClick"],Ft=["onClick"],Tt=["onClick"],Nt={key:3,class:"d-flex justify-content-between align-items-center mt-3"},Vt={class:"text-muted"},It={key:0},Ut={class:"pagination mb-0"},Pt=["disabled"],Lt=["onClick"],jt=["disabled"],Ot={class:"modal fade",id:"CategoryModal",tabindex:"-1"},qt={class:"modal-dialog modal-lg"},zt={class:"modal-content Category-modal-content"},Ht={class:"modal-header Category-modal-header"},Rt={class:"modal-title Category-modal-title"},Wt={class:"modal-body Category-modal-body"},Yt={class:"row g-3 mb-3"},Jt={class:"col-md-6"},Gt={class:"input-group"},Kt={class:"col-md-6"},Qt={class:"form-check form-switch mt-2"},Xt={class:"col-12"},Zt={class:"input-group"},$t={class:"modal-footer Category-modal-footer"},te={type:"submit",class:"btn btn-submit"},ee={class:"modal fade",id:"viewCategoryModal",tabindex:"-1"},oe={class:"modal-dialog"},ae={class:"modal-content"},se={class:"modal-body"},le={class:"Category-details"},ne={key:0},ie=["src"],re={key:1},de={class:"modal fade",id:"deletedCategoriesModal",tabindex:"-1"},ce={class:"modal-dialog modal-lg"},me={class:"modal-content"},ge={class:"modal-body"},ue={key:0,class:"text-center py-4 text-muted"},be={key:1,class:"table-responsive"},fe={class:"table table-hover table-sm"},ve=["onClick"];function pe(D,e,x,o,E,V){var B,v,F,k,y,p,b,_,T,N;const S=Z("draggable");return r(),i("div",nt,[t("div",it,[t("div",null,[t("button",{class:"btn btn-outline-secondary me-2",onClick:e[0]||(e[0]=(...a)=>o.showDeletedModal&&o.showDeletedModal(...a))},e[15]||(e[15]=[t("i",{class:"fas fa-trash-restore-alt me-1"},null,-1),m(" Deleted Categories ")]))]),e[17]||(e[17]=t("h4",{class:"mb-0"},"Manage Categories",-1)),t("button",{class:"btn btn-add-Category",onClick:e[1]||(e[1]=(...a)=>o.showCreateModal&&o.showCreateModal(...a))},e[16]||(e[16]=[t("i",{class:"fas fa-plus me-2"},null,-1),m("Add Category ")]))]),t("div",rt,[t("div",dt,[t("div",ct,[t("div",mt,[e[18]||(e[18]=t("label",{class:"form-label mb-1"},"Search",-1)),M(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.filters.search=a),onInput:e[3]||(e[3]=(...a)=>o.applyFilters&&o.applyFilters(...a)),type:"text",class:"form-control filter-input",placeholder:"Search by name or description"},null,544),[[U,o.filters.search]])]),t("div",gt,[e[20]||(e[20]=t("label",{class:"form-label mb-1"},"Category",-1)),M(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.filters.parent_id=a),onChange:e[5]||(e[5]=(...a)=>o.applyFilters&&o.applyFilters(...a)),class:"form-select filter-input"},[e[19]||(e[19]=t("option",{value:""},"All Categories",-1)),(r(!0),i(P,null,L(o.parentCategories,a=>(r(),i("option",{key:a.id,value:a.id},n(a.name),9,ut))),128))],544),[[q,o.filters.parent_id]])]),t("div",bt,[e[22]||(e[22]=t("label",{class:"form-label mb-1"},"Status",-1)),M(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.filters.is_active=a),onChange:e[7]||(e[7]=(...a)=>o.applyFilters&&o.applyFilters(...a)),class:"form-select filter-input"},e[21]||(e[21]=[t("option",{value:""},"All",-1),t("option",{value:!0},"Active",-1),t("option",{value:!1},"Inactive",-1)]),544),[[q,o.filters.is_active]])])])])]),t("div",ft,[t("div",vt,[o.loading?(r(),i("div",pt,e[23]||(e[23]=[t("div",{class:"spinner-border text-danger",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):o.categories.length===0?(r(),i("div",yt,e[24]||(e[24]=[t("i",{class:"fas fa-store fa-3x mb-3",style:{color:"#bdbdbd"}},null,-1),t("div",{class:"h5 mb-2"},"No Categories Found",-1),t("div",null,[m("No categories match your search criteria."),t("br"),m("Try adjusting your filters.")],-1)]))):(r(),i("div",Ct,[t("table",_t,[e[31]||(e[31]=t("thead",null,[t("tr",null,[t("th",{style:{width:"32px"}}),t("th",null,"Name"),t("th",{class:"d-none d-md-table-cell"},"Status"),t("th",{class:"d-none d-md-table-cell"},"Sort Order"),t("th",{class:"d-none d-md-table-cell"},"Created At"),t("th",{class:"d-none d-md-table-cell"},"Actions")])],-1)),Q(S,{modelValue:o.categories,"onUpdate:modelValue":e[8]||(e[8]=a=>o.categories=a),onEnd:o.onSortEnd,tag:"tbody",animation:200,handle:".drag-handle"},{item:X(({element:a})=>[(r(),i("tr",{key:a.id,class:A(["d-block d-md-table-row w-100 mb-2 mb-md-0",{"table-danger":a.deleted_at}])},[e[30]||(e[30]=t("td",null,[t("span",{class:"drag-handle",style:{cursor:"grab"}},[t("i",{class:"fas fa-grip-vertical"})])],-1)),t("td",null,[t("div",wt,n(a.name),1),t("div",ht,n(a.description),1)]),t("td",xt,[t("span",{class:A(["badge",a.is_active?"bg-success":"bg-danger"])},n(a.is_active?"Active":"Inactive"),3)]),t("td",kt,n(a.sort_order),1),t("td",Mt,n(new Date(a.created_at).toLocaleDateString()),1),t("td",Dt,[t("div",Et,[t("button",{class:"btn btn-sm btn-action btn-view me-1",onClick:w=>o.viewCategory(a)},e[25]||(e[25]=[t("i",{class:"fas fa-eye"},null,-1)]),8,St),a.deleted_at?h("",!0):(r(),i("button",{key:0,class:"btn btn-sm btn-action btn-edit me-1",onClick:w=>o.editCategory(a)},e[26]||(e[26]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Bt)),a.deleted_at?h("",!0):(r(),i("button",{key:1,class:"btn btn-sm btn-action btn-delete me-1",onClick:w=>o.confirmDelete(a)},e[27]||(e[27]=[t("i",{class:"fas fa-trash"},null,-1)]),8,At)),a.deleted_at?(r(),i("button",{key:2,class:"btn btn-sm btn-action btn-restore me-1",onClick:w=>o.restoreCategory(a)},e[28]||(e[28]=[t("i",{class:"fas fa-undo"},null,-1)]),8,Ft)):h("",!0),a.deleted_at?(r(),i("button",{key:3,class:"btn btn-sm btn-action btn-hard-delete",onClick:w=>o.confirmHardDelete(a)},e[29]||(e[29]=[t("i",{class:"fas fa-times"},null,-1)]),8,Tt)):h("",!0)])])],2))]),_:1},8,["modelValue","onEnd"])])])),o.pagination.total>0?(r(),i("div",Nt,[t("div",Vt," Showing "+n(o.pagination.from)+" to "+n(o.pagination.to)+" of "+n(o.pagination.total)+" entries ",1),o.pagination.last_page>1?(r(),i("nav",It,[t("ul",Ut,[t("li",{class:A(["page-item",{disabled:o.pagination.current_page===1}])},[t("button",{class:"page-link",onClick:e[9]||(e[9]=a=>o.goToPage(o.pagination.current_page-1)),disabled:o.pagination.current_page===1},"«",8,Pt)],2),(r(!0),i(P,null,L(o.paginationWindow,a=>(r(),i("li",{key:a,class:A(["page-item",{active:a===o.pagination.current_page}])},[t("button",{class:"page-link",onClick:w=>o.goToPage(a)},n(a),9,Lt)],2))),128)),t("li",{class:A(["page-item",{disabled:o.pagination.current_page===o.pagination.last_page}])},[t("button",{class:"page-link",onClick:e[10]||(e[10]=a=>o.goToPage(o.pagination.current_page+1)),disabled:o.pagination.current_page===o.pagination.last_page},"»",8,jt)],2)])])):h("",!0)])):h("",!0)])]),t("div",Ot,[t("div",qt,[t("div",zt,[t("div",Ht,[t("h5",Rt,n(o.isEditing?"Edit Category":"Add Category"),1),e[32]||(e[32]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),t("div",Wt,[t("form",{onSubmit:e[14]||(e[14]=$((...a)=>o.saveCategory&&o.saveCategory(...a),["prevent"]))},[t("div",Yt,[t("div",Jt,[t("div",Gt,[e[33]||(e[33]=t("span",{class:"input-group-text"},[t("i",{class:"fas fa-tag"})],-1)),M(t("input",{id:"categoryName",type:"text",class:"form-control","onUpdate:modelValue":e[11]||(e[11]=a=>o.form.name=a),required:"",placeholder:"Category Name"},null,512),[[U,o.form.name]])])]),t("div",Kt,[t("div",Qt,[M(t("input",{class:"form-check-input",type:"checkbox",id:"categoryStatus","onUpdate:modelValue":e[12]||(e[12]=a=>o.form.is_active=a)},null,512),[[tt,o.form.is_active]]),e[34]||(e[34]=t("label",{class:"form-check-label",for:"categoryStatus"},"Active",-1))])]),t("div",Xt,[t("div",Zt,[e[35]||(e[35]=t("span",{class:"input-group-text"},[t("i",{class:"fas fa-align-left"})],-1)),M(t("textarea",{id:"categoryDescription",class:"form-control","onUpdate:modelValue":e[13]||(e[13]=a=>o.form.description=a),rows:"3",placeholder:"Category Description"},null,512),[[U,o.form.description]])])])]),t("div",$t,[e[36]||(e[36]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",te,n(o.isEditing?"Update":"Create"),1)])],32)])])])]),t("div",ee,[t("div",oe,[t("div",ae,[e[46]||(e[46]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Category Details"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",se,[t("div",le,[t("p",null,[e[37]||(e[37]=t("strong",null,"Name:",-1)),m(" "+n((B=o.selectedCategory)==null?void 0:B.name),1)]),t("p",null,[e[38]||(e[38]=t("strong",null,"Description:",-1)),m(" "+n((v=o.selectedCategory)==null?void 0:v.description),1)]),t("p",null,[e[39]||(e[39]=t("strong",null,"Parent:",-1)),m(" "+n(((k=(F=o.selectedCategory)==null?void 0:F.parent)==null?void 0:k.name)||"None"),1)]),t("p",null,[e[40]||(e[40]=t("strong",null,"Status:",-1)),m(" "+n((y=o.selectedCategory)!=null&&y.is_active?"Active":"Inactive"),1)]),t("p",null,[e[41]||(e[41]=t("strong",null,"Sort Order:",-1)),m(" "+n((p=o.selectedCategory)==null?void 0:p.sort_order),1)]),(b=o.selectedCategory)!=null&&b.image?(r(),i("p",ne,[e[42]||(e[42]=t("strong",null,"Image:",-1)),e[43]||(e[43]=m()),t("img",{src:o.selectedCategory.image,class:"img-thumbnail mt-2",style:{"max-width":"200px"}},null,8,ie)])):h("",!0),t("p",null,[e[44]||(e[44]=t("strong",null,"Created At:",-1)),m(" "+n(new Date((_=o.selectedCategory)==null?void 0:_.created_at).toLocaleString()),1)]),(T=o.selectedCategory)!=null&&T.deleted_at?(r(),i("p",re,[e[45]||(e[45]=t("strong",null,"Deleted At:",-1)),m(" "+n(new Date((N=o.selectedCategory)==null?void 0:N.deleted_at).toLocaleString()),1)])):h("",!0)])]),e[47]||(e[47]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),t("div",de,[t("div",ce,[t("div",me,[e[51]||(e[51]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Deleted Categories"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ge,[o.deletedCategories.length===0?(r(),i("div",ue,e[48]||(e[48]=[t("i",{class:"fas fa-store-slash fa-2x mb-2"},null,-1),t("div",null,"No deleted categories found.",-1)]))):(r(),i("div",be,[t("table",fe,[e[50]||(e[50]=t("thead",null,[t("tr",null,[t("th",null,"Name"),t("th",null,"Description"),t("th",null,"Deleted At"),t("th",null,"Action")])],-1)),t("tbody",null,[(r(!0),i(P,null,L(o.deletedCategories,a=>(r(),i("tr",{key:a.id},[t("td",null,n(a.name),1),t("td",null,n(a.description),1),t("td",null,n(new Date(a.deleted_at).toLocaleString()),1),t("td",null,[t("button",{class:"btn btn-sm btn-success",onClick:w=>o.restoreCategory(a)},e[49]||(e[49]=[t("i",{class:"fas fa-undo"},null,-1),m(" Restore")]),8,ve)])]))),128))])])]))])])])])])}const _e=K(lt,[["render",pe],["__scopeId","data-v-04697290"]]);export{_e as default};
//# sourceMappingURL=Categories-pbYeHAPk.js.map
